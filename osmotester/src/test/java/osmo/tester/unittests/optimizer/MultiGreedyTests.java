package osmo.tester.unittests.optimizer;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import osmo.common.TestUtils;
import osmo.tester.OSMOConfiguration;
import osmo.tester.coverage.ScoreConfiguration;
import osmo.tester.coverage.TestCoverage;
import osmo.tester.generator.ReflectiveModelFactory;
import osmo.tester.generator.endcondition.LengthProbability;
import osmo.tester.generator.testsuite.TestCase;
import osmo.tester.model.ModelFactory;
import osmo.tester.model.TestModels;
import osmo.tester.optimizer.greedy.IterationListener;
import osmo.tester.optimizer.greedy.MultiGreedy;
import osmo.tester.unittests.testmodels.CalculatorModel;
import osmo.tester.unittests.testmodels.RandomValueModel4;
import osmo.tester.unittests.testmodels.VendingMachine;

import java.util.List;

import static org.junit.Assert.*;

/** @author Teemu Kanstren */
public class MultiGreedyTests {
  @Before
  public void initTest() {
    TestUtils.startOutputCapture();
  }

  @After
  public void resetAfter() {
    TestUtils.endOutputCapture();
  }

  @Test
  public void calculatorOptimization() throws Exception {
    OSMOConfiguration oc = new OSMOConfiguration();
    oc.setTestEndCondition(new LengthProbability(1, 5, 0.2d));
    oc.setFactory(new MyModelFactory());
    oc.setTrackOptions(true);
    ScoreConfiguration config = new ScoreConfiguration();
    config.setLengthWeight(0);
    MultiGreedy multiGreedy = new MultiGreedy(oc, config, 111, 5);
    List<TestCase> tests = multiGreedy.search();
    assertEquals("Number of tests from MultiGreedy", 3, tests.size());
    assertEquals("MultiGreedy test1", "TestCase:[start, increase, decrease, increase, increase]", tests.get(0).toString());
    assertEquals("MultiGreedy test2", "TestCase:[start, increase, increase, decrease, decrease]", tests.get(1).toString());
    assertEquals("MultiGreedy test3", "TestCase:[start, increase, increase, increase, increase]", tests.get(2).toString());
    String report = TestUtils.readFile(multiGreedy.createFinalReportPath(), "UTF8");
    String expected = TestUtils.getResource(GreedyTests.class, "expected-multigreedy.txt");
    assertEquals("Multi-Greedy report", expected, report);
    }

  @Test
  public void maxLength() {
    OSMOConfiguration oc = new OSMOConfiguration();
    ScoreConfiguration sc = new ScoreConfiguration();
    oc.setFactory(new ReflectiveModelFactory(RandomValueModel4.class));
    oc.setTestEndCondition(new LengthProbability(5, 1d));
    MultiGreedy greedy = new MultiGreedy(oc, sc, 1);
    greedy.setMax(2);
    greedy.setTimeout(2);
    greedy.setThreshold(-1);
    List<TestCase> tests = greedy.search();
    assertEquals("Number of tests from greedy with max", 2, tests.size());
    //asserting the score might be useful as well to see it performs better. but would require better test model.
  }

  @Test
  public void iterationListener() {
    OSMOConfiguration oc = new OSMOConfiguration();
    ScoreConfiguration sc = new ScoreConfiguration();
    oc.setFactory(new ReflectiveModelFactory(RandomValueModel4.class));
    oc.setTestEndCondition(new LengthProbability(5, 1d));
    MultiGreedy greedy = new MultiGreedy(oc, sc, 1);
    greedy.setTimeout(2);
    greedy.setThreshold(-1);
    MyIterationListener listener = new MyIterationListener();
    greedy.addIterationListener(listener);
    List<TestCase> tests = greedy.search();
//    assertEquals("Number of iterations", 2, listener.count);
    assertEquals("Number of iterations", 1, listener.finished);
    assertEquals("Final tests", tests, listener.finalTests);
  }

  @Test
  public void deterministic1() {
    OSMOConfiguration oc = new OSMOConfiguration();
    oc.setTestEndCondition(new LengthProbability(10, 20, 0.2d));
    oc.setFactory(models -> models.add(new VendingMachine()));
    ScoreConfiguration config = new ScoreConfiguration();
    config.setLengthWeight(0);
    MultiGreedy mg = new MultiGreedy(oc, config, 111, 1);
    mg.setPopulationSize(500);
    mg.setMaxIterations(5);
    List<TestCase> tests = mg.search();
    assertEquals("Number of generated tests", 288, tests.size());
    TestCoverage coverage = tests.get(0).getCoverage();
    assertEquals("Requirements coverage", "[50cents, 20cents, 10cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, 20cents, 10cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Fluffy Zombie, Pink Potato]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Fluffy Zombie, Fluffy Zombie->Pink Potato]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 20, coverage.getTotalSteps());
    assertEquals("Variable value total count", 23, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=7, 20cents=6, 10cents=5, vend=2}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->20cents, 20cents->50cents, 50cents->50cents, 50cents->10cents, 10cents->20cents, 20cents->20cents, 20cents->10cents, 10cents->10cents, 10cents->50cents, 10cents->vend, vend->20cents, 50cents->vend, vend->10cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 70, 120, 170, 180, 200, 220, 230, 240, 290, 300, 140, 160, 210, 260, 310, 65, 75, 95, 115], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = tests.get(287).getCoverage();
    assertEquals("Requirements coverage", "[50cents, vend, 10cents, 20cents]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, vend, 10cents, 20cents]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Regular Sheep, Turqoise Dog]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Regular Sheep, Regular Sheep->Turqoise Dog]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 15, coverage.getTotalSteps());
    assertEquals("Variable value total count", 18, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=7, vend=2, 10cents=3, 20cents=3}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->50cents, 50cents->vend, vend->50cents, 50cents->10cents, 10cents->10cents, 10cents->50cents, 50cents->20cents, 20cents->10cents, 10cents->20cents, 20cents->20cents, 20cents->vend]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 100, 150, 200, 250, 65, 115, 125, 135, 185, 205, 215, 235, 255, 75], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = mg.getFinalCoverage();
    assertEquals("Requirements coverage", "[50cents, 20cents, 10cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, 20cents, 10cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 210, coverage.getStateCount());
    assertEquals("State pair count", 419, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Fluffy Zombie, Pink Potato, Green Skeleton, Small Chicken, Pink Creeper, Pink Skeleton, Small Apple Juice, White Creeper, Orange Pellegrino, White Carrot, Blue Corn, Yellow Beer, Orange Dog, Blue Cinnabon, Blue Fanta, Spotted Dog, Orange Cookie, Brown Cat, Purple Chicken, Big Cat, Turqoise Pigman, White Piglet, Pink Chicken, Brown Milkshake, Pink Chocolate bar, Spotted Pigman, Orange Pepper, White Chocolate bar, Blue Milkshake, Green Apple Juice, Blue Banana, Brown Horse, Orange Parsnip, Small Piglet, White Chicken, Red Pepper, Blue Beer, Regular Pellegrino, Orange Orange Juice, Big Fanta, Brown Turnip, Small Potato, Spotted Orange Juice, Small Vichy, Orange Sheep, Regular Parsnip, Spotted Pepsi, Purple Chocolate bar, Purple Mountain Dew, Spotted Parsnip, Pink Spite, Regular Orange Juice, Brown Cinnabon, Blue Perrier, Purple Twinkie, Yellow Horse, Yellow Corn, Regular Spider, Fluffy Cat, Red Coke, Brown Zombie, Turqoise Coke, Purple Piglet, Regular Chocolate Milk, Small Skeleton, White Mountain Dew, Pink Doughnut, Turqoise Spider, Brown Milk, Spotted Pellegrino, Yellow Turnip, Regular Pigman, Big Corn, Yellow Cucumber, White Twinkie, Yellow Banana, Regular Coke, Yellow Cat, Pink Bell Pepper, Red Daikon, Small Bell Pepper, Regular Dog, Big Turnip, Yellow Fanta, Red Pellegrino, Green Vichy, Green Bell Pepper, Yellow Gummy bears, Regular Pepper, Big Milk, Fluffy Horse, Spotted Sheep, Pink Apple Juice, Pink Piglet, Red Orange Juice, Orange Daikon, Purple Apple Juice, Regular Cookie, White Bell Pepper, Pink Vichy, Red Dog, Pink Carrot, White Apple Juice, Turqoise Dog, Purple Vichy, Big Beer, Red Parsnip, Turqoise Pepsi, Fluffy Fanta, Red Pigman, Green Chocolate bar, Brown Perrier, White Skeleton, Fluffy Milk, Red Pepsi, Brown Gummy bears, Purple Skeleton, Fluffy Corn, Small Doughnut, Fluffy Cucumber, Fluffy Gummy bears, Red Cookie, Blue Horse, Spotted Chocolate Milk, Orange Chocolate Milk, Purple Bell Pepper, Blue Zombie, Fluffy Cinnabon, Purple Spite, Blue Cucumber, Fluffy Banana, Turqoise Daikon, Turqoise Chocolate Milk, White Spite, Purple Carrot, Purple Creeper, Yellow Cinnabon, Small Chocolate bar, Orange Pepsi, White Potato, Red Chocolate Milk, Pink Twinkie, White Doughnut, Brown Beer, Green Potato, Turqoise Cookie, Regular Sheep, Turqoise Wine, Turqoise Sheep, Turqoise Pepper, Big Milkshake, Big Cucumber, Big Horse, Spotted Coke, Yellow Milkshake, Purple Doughnut, Yellow Zombie, Regular Wine, Small Mountain Dew, Green Mountain Dew, Small Spite, Red Spider, Yellow Perrier, Big Gummy bears, Big Cinnabon, Big Zombie, Turqoise Parsnip, Spotted Daikon, Brown Banana, Yellow Milk, Green Creeper, Blue Milk, White Vichy, Fluffy Perrier, Green Carrot, Spotted Cookie, Orange Spider, Fluffy Milkshake, Green Twinkie, Orange Coke, Spotted Spider, Orange Pigman, Small Twinkie, Turqoise Orange Juice, Spotted Wine, Orange Wine, Green Doughnut, Turqoise Pellegrino, Pink Mountain Dew, Blue Cat, Regular Pepsi, Blue Gummy bears, Red Sheep, Brown Corn, Brown Fanta, Brown Cucumber, Spotted Pepper, Purple Potato, Small Carrot, Small Creeper, Fluffy Beer, Fluffy Turnip, Blue Turnip, Big Banana, Big Perrier, Green Piglet, Regular Daikon, Green Chicken, Red Wine, Green Spite]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Fluffy Zombie, Fluffy Zombie->Pink Potato, osmo.tester.START_STATE->Green Skeleton, Green Skeleton->Small Chicken, osmo.tester.START_STATE->Pink Creeper, Pink Creeper->Pink Skeleton, Pink Skeleton->Small Apple Juice, osmo.tester.START_STATE->White Creeper, White Creeper->Orange Pellegrino, osmo.tester.START_STATE->White Carrot, White Carrot->Blue Corn, osmo.tester.START_STATE->Yellow Beer, Yellow Beer->Orange Dog, osmo.tester.START_STATE->Blue Cinnabon, Blue Cinnabon->Blue Fanta, osmo.tester.START_STATE->Spotted Dog, Spotted Dog->Orange Cookie, osmo.tester.START_STATE->Brown Cat, Brown Cat->Purple Chicken, osmo.tester.START_STATE->Big Cat, Big Cat->Turqoise Pigman, osmo.tester.START_STATE->White Piglet, White Piglet->Pink Chicken, osmo.tester.START_STATE->Brown Milkshake, Brown Milkshake->Pink Chocolate bar, osmo.tester.START_STATE->Spotted Pigman, Spotted Pigman->Orange Pepper, osmo.tester.START_STATE->White Chocolate bar, White Chocolate bar->Blue Milkshake, osmo.tester.START_STATE->Green Apple Juice, Green Apple Juice->Blue Banana, osmo.tester.START_STATE->Brown Horse, Brown Horse->Orange Parsnip, osmo.tester.START_STATE->Small Piglet, Small Piglet->White Chicken, osmo.tester.START_STATE->Red Pepper, Red Pepper->Blue Beer, osmo.tester.START_STATE->Regular Pellegrino, Regular Pellegrino->Orange Orange Juice, osmo.tester.START_STATE->Big Fanta, Big Fanta->Brown Turnip, osmo.tester.START_STATE->Small Potato, Small Potato->Spotted Orange Juice, osmo.tester.START_STATE->Small Vichy, Small Vichy->Orange Sheep, osmo.tester.START_STATE->Regular Parsnip, Regular Parsnip->Spotted Pepsi, osmo.tester.START_STATE->Purple Chocolate bar, Purple Chocolate bar->Purple Mountain Dew, osmo.tester.START_STATE->Spotted Parsnip, Spotted Parsnip->Pink Spite, osmo.tester.START_STATE->Regular Orange Juice, Regular Orange Juice->Brown Cinnabon, osmo.tester.START_STATE->Blue Perrier, Blue Perrier->Purple Twinkie, osmo.tester.START_STATE->Yellow Horse, Yellow Horse->Yellow Corn, osmo.tester.START_STATE->Regular Spider, Regular Spider->Fluffy Cat, osmo.tester.START_STATE->Red Coke, Red Coke->Brown Zombie, osmo.tester.START_STATE->Turqoise Coke, Turqoise Coke->Purple Piglet, osmo.tester.START_STATE->Regular Chocolate Milk, Regular Chocolate Milk->Small Skeleton, osmo.tester.START_STATE->White Mountain Dew, White Mountain Dew->Pink Doughnut, osmo.tester.START_STATE->Turqoise Spider, Turqoise Spider->Brown Milk, osmo.tester.START_STATE->Spotted Pellegrino, Spotted Pellegrino->Yellow Turnip, osmo.tester.START_STATE->Regular Pigman, Regular Pigman->Big Corn, osmo.tester.START_STATE->Yellow Cucumber, Yellow Cucumber->White Twinkie, osmo.tester.START_STATE->Yellow Banana, Yellow Banana->Regular Coke, osmo.tester.START_STATE->Yellow Cat, Yellow Cat->Pink Bell Pepper, osmo.tester.START_STATE->Red Daikon, Red Daikon->Small Bell Pepper, osmo.tester.START_STATE->Regular Dog, Regular Dog->Big Turnip, osmo.tester.START_STATE->Yellow Fanta, Yellow Fanta->Red Pellegrino, osmo.tester.START_STATE->Green Vichy, Green Vichy->Green Bell Pepper, osmo.tester.START_STATE->Yellow Gummy bears, Yellow Gummy bears->Regular Pepper, osmo.tester.START_STATE->Big Milk, Big Milk->Fluffy Horse, osmo.tester.START_STATE->Spotted Sheep, Spotted Sheep->Pink Apple Juice, osmo.tester.START_STATE->Pink Piglet, Pink Piglet->Red Orange Juice, osmo.tester.START_STATE->Orange Daikon, Orange Daikon->Purple Apple Juice, osmo.tester.START_STATE->Regular Cookie, Regular Cookie->White Bell Pepper, osmo.tester.START_STATE->Pink Vichy, Pink Vichy->Red Dog, osmo.tester.START_STATE->Pink Carrot, Pink Carrot->White Apple Juice, osmo.tester.START_STATE->Turqoise Dog, Turqoise Dog->Purple Vichy, osmo.tester.START_STATE->Big Beer, Big Beer->Red Parsnip, osmo.tester.START_STATE->Turqoise Pepsi, Turqoise Pepsi->Fluffy Fanta, osmo.tester.START_STATE->Red Pigman, Red Pigman->Green Chocolate bar, osmo.tester.START_STATE->Brown Perrier, Brown Perrier->White Skeleton, osmo.tester.START_STATE->Fluffy Milk, Fluffy Milk->Red Pepsi, osmo.tester.START_STATE->Brown Gummy bears, Brown Gummy bears->Purple Skeleton, osmo.tester.START_STATE->Fluffy Corn, Fluffy Corn->Small Doughnut, osmo.tester.START_STATE->Fluffy Cucumber, Fluffy Cucumber->Fluffy Gummy bears, osmo.tester.START_STATE->Red Cookie, Red Cookie->Blue Horse, osmo.tester.START_STATE->Spotted Chocolate Milk, Spotted Chocolate Milk->Orange Chocolate Milk, osmo.tester.START_STATE->Purple Bell Pepper, Purple Bell Pepper->Blue Zombie, osmo.tester.START_STATE->Fluffy Cinnabon, Fluffy Cinnabon->Purple Spite, osmo.tester.START_STATE->Blue Cucumber, Blue Cucumber->Fluffy Banana, osmo.tester.START_STATE->Turqoise Daikon, Turqoise Daikon->Turqoise Chocolate Milk, osmo.tester.START_STATE->White Spite, White Spite->Purple Carrot, osmo.tester.START_STATE->Purple Creeper, Purple Creeper->Yellow Cinnabon, osmo.tester.START_STATE->Small Chocolate bar, Small Chocolate bar->Brown Milkshake, osmo.tester.START_STATE->Blue Corn, Blue Corn->Orange Pepsi, osmo.tester.START_STATE->Orange Dog, Orange Dog->White Potato, osmo.tester.START_STATE->Red Chocolate Milk, Red Chocolate Milk->Pink Creeper, osmo.tester.START_STATE->Blue Fanta, Blue Fanta->Pink Twinkie, osmo.tester.START_STATE->White Doughnut, White Doughnut->Blue Corn, osmo.tester.START_STATE->Brown Beer, Brown Beer->Brown Beer, osmo.tester.START_STATE->Green Potato, Green Potato->Spotted Pepsi, osmo.tester.START_STATE->White Chicken, White Chicken->Turqoise Cookie, osmo.tester.START_STATE->Regular Sheep, Regular Sheep->Regular Sheep, osmo.tester.START_STATE->Turqoise Wine, Turqoise Wine->Fluffy Zombie, osmo.tester.START_STATE->Turqoise Sheep, Turqoise Sheep->Spotted Pepsi, osmo.tester.START_STATE->Purple Twinkie, Purple Twinkie->Turqoise Pepper, osmo.tester.START_STATE->Big Milkshake, Big Milkshake->Yellow Turnip, osmo.tester.START_STATE->Big Cucumber, Big Cucumber->Pink Chocolate bar, osmo.tester.START_STATE->Big Horse, Big Horse->Red Pepper, osmo.tester.START_STATE->Spotted Coke, Spotted Coke->Pink Potato, osmo.tester.START_STATE->Yellow Milkshake, Yellow Milkshake->Pink Doughnut, osmo.tester.START_STATE->Purple Doughnut, Purple Doughnut->Pink Chicken, osmo.tester.START_STATE->Yellow Zombie, Yellow Zombie->Red Parsnip, osmo.tester.START_STATE->Turqoise Pigman, Turqoise Pigman->Regular Wine, osmo.tester.START_STATE->Purple Vichy, Purple Vichy->Small Mountain Dew, osmo.tester.START_STATE->Fluffy Horse, Fluffy Horse->Green Mountain Dew, osmo.tester.START_STATE->Small Spite, Small Spite->Yellow Turnip, osmo.tester.START_STATE->Green Chocolate bar, Green Chocolate bar->Red Spider, osmo.tester.START_STATE->Big Turnip, Big Turnip->Yellow Perrier, osmo.tester.START_STATE->White Apple Juice, White Apple Juice->Big Gummy bears, osmo.tester.START_STATE->Big Cinnabon, Big Cinnabon->Fluffy Zombie, osmo.tester.START_STATE->Big Zombie, Big Zombie->Purple Piglet, osmo.tester.START_STATE->Turqoise Parsnip, Turqoise Parsnip->Turqoise Coke, osmo.tester.START_STATE->Small Apple Juice, Small Apple Juice->Spotted Daikon, osmo.tester.START_STATE->Small Chicken, Small Chicken->Brown Banana, osmo.tester.START_STATE->Fluffy Gummy bears, Fluffy Gummy bears->Yellow Milk, osmo.tester.START_STATE->Green Creeper, Green Creeper->Fluffy Gummy bears, osmo.tester.START_STATE->Blue Milk, Blue Milk->Purple Vichy, osmo.tester.START_STATE->White Vichy, White Vichy->Turqoise Pigman, osmo.tester.START_STATE->Fluffy Perrier, Fluffy Perrier->Purple Twinkie, osmo.tester.START_STATE->Green Carrot, Green Carrot->Spotted Sheep, osmo.tester.START_STATE->Spotted Cookie, osmo.tester.START_STATE->Orange Spider, osmo.tester.START_STATE->Fluffy Milkshake, osmo.tester.START_STATE->Green Twinkie, osmo.tester.START_STATE->Orange Coke, osmo.tester.START_STATE->Spotted Spider, osmo.tester.START_STATE->Orange Pigman, osmo.tester.START_STATE->Small Twinkie, osmo.tester.START_STATE->Turqoise Orange Juice, osmo.tester.START_STATE->Spotted Wine, osmo.tester.START_STATE->Orange Wine, osmo.tester.START_STATE->Green Doughnut, osmo.tester.START_STATE->Turqoise Pellegrino, osmo.tester.START_STATE->Pink Mountain Dew, osmo.tester.START_STATE->Blue Cat, osmo.tester.START_STATE->Regular Pepsi, osmo.tester.START_STATE->Blue Gummy bears, osmo.tester.START_STATE->Red Sheep, osmo.tester.START_STATE->Brown Corn, osmo.tester.START_STATE->Brown Fanta, osmo.tester.START_STATE->Brown Cucumber, osmo.tester.START_STATE->Spotted Pepper, osmo.tester.START_STATE->Purple Potato, osmo.tester.START_STATE->Small Carrot, osmo.tester.START_STATE->Small Creeper, osmo.tester.START_STATE->Fluffy Beer, osmo.tester.START_STATE->Fluffy Turnip, osmo.tester.START_STATE->Blue Turnip, osmo.tester.START_STATE->Big Banana, osmo.tester.START_STATE->Big Perrier, osmo.tester.START_STATE->Green Piglet, osmo.tester.START_STATE->Regular Daikon, osmo.tester.START_STATE->Green Chicken, osmo.tester.START_STATE->Red Wine, osmo.tester.START_STATE->Green Spite, osmo.tester.START_STATE->Red Dog, Red Dog->Blue Cinnabon, osmo.tester.START_STATE->Orange Parsnip, Orange Parsnip->Red Coke, osmo.tester.START_STATE->Turqoise Chocolate Milk, Turqoise Chocolate Milk->Small Piglet, osmo.tester.START_STATE->Regular Pepper, Regular Pepper->Purple Chicken, osmo.tester.START_STATE->Yellow Corn, Yellow Corn->Spotted Parsnip, osmo.tester.START_STATE->Brown Turnip, Brown Turnip->Regular Pellegrino, osmo.tester.START_STATE->Yellow Cinnabon, Yellow Cinnabon->White Chicken, osmo.tester.START_STATE->Pink Twinkie, Pink Twinkie->Small Potato, osmo.tester.START_STATE->Purple Apple Juice, Purple Apple Juice->Orange Daikon, osmo.tester.START_STATE->Brown Milk, Brown Milk->White Twinkie, osmo.tester.START_STATE->Blue Milkshake, Blue Milkshake->Red Pepsi, osmo.tester.START_STATE->White Potato, White Potato->Big Milk, osmo.tester.START_STATE->Big Corn, Big Corn->Blue Milkshake, osmo.tester.START_STATE->Purple Mountain Dew, Purple Mountain Dew->Blue Perrier, osmo.tester.START_STATE->Orange Pellegrino, Orange Pellegrino->Turqoise Sheep, osmo.tester.START_STATE->Pink Spite, Pink Spite->Brown Cat, osmo.tester.START_STATE->Small Doughnut, Small Doughnut->Blue Horse, osmo.tester.START_STATE->Brown Cinnabon, Brown Cinnabon->Yellow Cinnabon, osmo.tester.START_STATE->Orange Orange Juice, Orange Orange Juice->Blue Cucumber, osmo.tester.START_STATE->Blue Horse, Blue Horse->Yellow Zombie, osmo.tester.START_STATE->Red Parsnip, Red Parsnip->Big Cat, osmo.tester.START_STATE->Small Bell Pepper, Small Bell Pepper->Purple Chicken, osmo.tester.START_STATE->Small Mountain Dew, Small Mountain Dew->Purple Creeper, osmo.tester.START_STATE->Pink Potato, Pink Potato->Small Mountain Dew, osmo.tester.START_STATE->Spotted Orange Juice, osmo.tester.START_STATE->Orange Sheep, osmo.tester.START_STATE->Turqoise Cookie, osmo.tester.START_STATE->Spotted Daikon, osmo.tester.START_STATE->Blue Zombie, osmo.tester.START_STATE->Orange Chocolate Milk, osmo.tester.START_STATE->Regular Wine, osmo.tester.START_STATE->Blue Beer, osmo.tester.START_STATE->Brown Zombie, osmo.tester.START_STATE->Green Mountain Dew, osmo.tester.START_STATE->Regular Coke, osmo.tester.START_STATE->Yellow Perrier, osmo.tester.START_STATE->Red Pepsi, osmo.tester.START_STATE->Pink Bell Pepper, Big Fanta->Small Doughnut, osmo.tester.START_STATE->White Skeleton, Blue Corn->Regular Pigman, osmo.tester.START_STATE->Small Skeleton, Spotted Dog->Blue Zombie, osmo.tester.START_STATE->Orange Pepsi, osmo.tester.START_STATE->Purple Spite, osmo.tester.START_STATE->Yellow Milk, Big Fanta->White Creeper, osmo.tester.START_STATE->Blue Banana, Blue Cinnabon->Red Pepsi, osmo.tester.START_STATE->White Twinkie, osmo.tester.START_STATE->Spotted Pepsi, Blue Cucumber->Red Pepper, osmo.tester.START_STATE->Purple Skeleton, osmo.tester.START_STATE->Red Orange Juice, osmo.tester.START_STATE->Red Spider, Small Vichy->Small Chocolate bar, osmo.tester.START_STATE->Pink Chicken, Yellow Gummy bears->Spotted Pepsi, osmo.tester.START_STATE->Pink Skeleton, osmo.tester.START_STATE->Pink Chocolate bar, osmo.tester.START_STATE->Purple Chicken, osmo.tester.START_STATE->Orange Pepper, osmo.tester.START_STATE->Fluffy Fanta, White Piglet->Purple Potato, osmo.tester.START_STATE->Red Pellegrino, osmo.tester.START_STATE->Purple Carrot, osmo.tester.START_STATE->Pink Apple Juice, osmo.tester.START_STATE->Pink Doughnut, Spotted Parsnip->Orange Coke, Spotted Parsnip->Red Pigman, osmo.tester.START_STATE->Big Gummy bears, Small Vichy->Yellow Milkshake, Spotted Dog->Red Orange Juice, osmo.tester.START_STATE->Fluffy Cat, Big Fanta->Pink Chocolate bar, Yellow Beer->Purple Piglet, osmo.tester.START_STATE->Green Bell Pepper, Blue Cinnabon->Spotted Dog, White Mountain Dew->White Mountain Dew, osmo.tester.START_STATE->Purple Piglet, osmo.tester.START_STATE->Turqoise Pepper, Small Apple Juice->Green Apple Juice, osmo.tester.START_STATE->Brown Banana, Blue Fanta->Orange Pepper, osmo.tester.START_STATE->Orange Cookie, osmo.tester.START_STATE->Fluffy Banana, Turqoise Pepsi->Turqoise Pepsi, Red Daikon->Green Potato, Orange Parsnip->Regular Dog, Brown Gummy bears->Small Chicken, osmo.tester.START_STATE->Yellow Turnip, Fluffy Milk->Purple Piglet, Turqoise Coke->Purple Chocolate bar, Red Pepper->Pink Doughnut, Yellow Cat->Small Carrot, Small Chocolate bar->Small Chocolate bar, Yellow Cat->Pink Skeleton, osmo.tester.START_STATE->White Bell Pepper, Red Coke->Small Piglet, Green Vichy->Big Perrier, Blue Cinnabon->Turqoise Wine, Green Vichy->Red Spider, Purple Bell Pepper->Spotted Pigman, Regular Pepper->Turqoise Sheep, Regular Spider->Yellow Corn, Purple Vichy->Purple Creeper, Turqoise Pepsi->Regular Cookie, Blue Fanta->Orange Wine, Turqoise Chocolate Milk->Regular Spider, Red Pigman->Purple Vichy, Regular Orange Juice->Brown Zombie, Big Milk->Turqoise Pellegrino, Brown Cat->Spotted Parsnip, Blue Perrier->Small Apple Juice, Regular Parsnip->Small Chocolate bar, Yellow Cat->Green Doughnut, Turqoise Chocolate Milk->Yellow Corn, Blue Perrier->Big Corn, Big Beer->Blue Gummy bears, Yellow Zombie->Turqoise Coke, Regular Orange Juice->Yellow Milkshake, Purple Doughnut->Purple Doughnut, Fluffy Zombie->Small Twinkie, Red Pepper->Orange Dog, Turqoise Pigman->Brown Cinnabon, Purple Doughnut->Yellow Fanta, Blue Fanta->Red Coke, Big Turnip->Big Fanta, White Chocolate bar->Spotted Coke, Blue Perrier->Turqoise Wine, Blue Cucumber->Fluffy Corn, Turqoise Chocolate Milk->Yellow Gummy bears, Small Piglet->Turqoise Wine, Fluffy Cucumber->Spotted Pepsi, Regular Pellegrino->Purple Spite, Regular Dog->Brown Beer, Yellow Fanta->Spotted Pellegrino, Brown Cinnabon->Spotted Coke, Brown Beer->Yellow Cat, Purple Apple Juice->Red Chocolate Milk, Green Potato->Pink Potato, Blue Fanta->Turqoise Orange Juice, Blue Perrier->Fluffy Gummy bears, Spotted Chocolate Milk->Blue Milk, Turqoise Dog->Fluffy Corn, Big Milk->White Piglet, Regular Sheep->Turqoise Dog]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 5176, coverage.getTotalSteps());
    assertEquals("Variable value total count", 74, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=1905, 20cents=1399, 10cents=1375, vend=497}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->20cents, 20cents->50cents, 50cents->50cents, 50cents->10cents, 10cents->20cents, 20cents->20cents, 20cents->10cents, 10cents->10cents, 10cents->50cents, 10cents->vend, vend->20cents, 50cents->vend, vend->10cents, .osmo.tester.start.step->10cents, vend->50cents, 20cents->vend, .osmo.tester.start.step->20cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 70, 120, 170, 180, 200, 220, 230, 240, 290, 300, 140, 160, 210, 260, 310, 65, 75, 95, 115, 10, 20, 40, 60, 110, 270, 125, 175, 225, 245, 255, 265, 285, 45, 100, 150, 250, 90, 280, 330, 130, 190, 30, 80, 320, 155, 185, 195, 215, 235, 5, 25, 135, 205, 55, 85, 105, 275, 295, 345, 145, 165, 35, 15, 340, 305, 315, 335, 325, 0], bottles=[10, 9, 8, 7]}", coverage.getVariableValues().toString());
  }

  @Test
  public void deterministic() {
    OSMOConfiguration oc = new OSMOConfiguration();
    oc.setTestEndCondition(new LengthProbability(10, 20, 0.2d));
    oc.setFactory(models -> models.add(new VendingMachine()));
    ScoreConfiguration config = new ScoreConfiguration();
    config.setLengthWeight(0);
    MultiGreedy mg = new MultiGreedy(oc, config, 111, 2);
    mg.setPopulationSize(500);
    mg.setMaxIterations(5);
    List<TestCase> tests = mg.search();
    assertEquals("Number of generated tests", 440, tests.size());
    TestCoverage coverage = tests.get(0).getCoverage();
    assertEquals("Requirements coverage", "[50cents, 20cents, 10cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, 20cents, 10cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("Step total count", 20, coverage.getTotalSteps());
    assertEquals("Variable value total count", 23, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=7, 20cents=6, 10cents=5, vend=2}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->20cents, 20cents->50cents, 50cents->50cents, 50cents->10cents, 10cents->20cents, 20cents->20cents, 20cents->10cents, 10cents->10cents, 10cents->50cents, 10cents->vend, vend->20cents, 50cents->vend, vend->10cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 70, 120, 170, 180, 200, 220, 230, 240, 290, 300, 140, 160, 210, 260, 310, 65, 75, 95, 115], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = tests.get(287).getCoverage();
    assertEquals("Requirements coverage", "[20cents, 50cents, 10cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[20cents, 50cents, 10cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Orange Spider, Blue Cat]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Orange Spider, Orange Spider->Blue Cat]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 16, coverage.getTotalSteps());
    assertEquals("Variable value total count", 18, coverage.getValueCount());
    assertEquals("Step coverage", "{20cents=3, 50cents=6, 10cents=5, vend=2}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->20cents, 20cents->50cents, 50cents->10cents, 10cents->20cents, 20cents->10cents, 10cents->50cents, 50cents->50cents, 50cents->vend, vend->10cents, 10cents->10cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[20, 70, 80, 100, 110, 160, 210, 260, 310, 150, 170, 190, 200, 250, 15], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = tests.get(439).getCoverage();
    assertEquals("Requirements coverage", "[50cents, vend, 10cents, 20cents]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, vend, 10cents, 20cents]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Regular Sheep, Turqoise Dog]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Regular Sheep, Regular Sheep->Turqoise Dog]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 15, coverage.getTotalSteps());
    assertEquals("Variable value total count", 18, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=7, vend=2, 10cents=3, 20cents=3}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->50cents, 50cents->vend, vend->50cents, 50cents->10cents, 10cents->10cents, 10cents->50cents, 50cents->20cents, 20cents->10cents, 10cents->20cents, 20cents->20cents, 20cents->vend]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 100, 150, 200, 250, 65, 115, 125, 135, 185, 205, 215, 235, 255, 75], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = mg.getFinalCoverage();
    assertEquals("Requirements coverage", "[50cents, 20cents, 10cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, 20cents, 10cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 210, coverage.getStateCount());
    assertEquals("State pair count", 625, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Fluffy Zombie, Pink Potato, Green Skeleton, Small Chicken, Pink Creeper, Pink Skeleton, Small Apple Juice, Regular Chocolate Milk, Big Horse, Spotted Pepper, Orange Parsnip, Turqoise Daikon, Turqoise Chocolate Milk, White Bell Pepper, Green Chocolate bar, Orange Spider, Fluffy Cat, Regular Pigman, Red Chocolate Milk, Spotted Dog, Blue Zombie, Fluffy Beer, Spotted Parsnip, Regular Coke, Pink Carrot, Spotted Pigman, Orange Pepper, White Chocolate bar, Blue Milkshake, Green Apple Juice, Blue Banana, Small Chocolate bar, Fluffy Banana, Fluffy Turnip, White Spite, Blue Cinnabon, Blue Fanta, Brown Cat, Purple Chicken, Blue Corn, Orange Pepsi, Orange Dog, White Potato, Small Piglet, White Chicken, Turqoise Parsnip, Red Pepsi, Red Pepper, Blue Beer, Regular Pellegrino, Orange Orange Juice, Big Fanta, Brown Turnip, Small Potato, Spotted Orange Juice, Small Vichy, Orange Sheep, Pink Twinkie, Big Cucumber, Purple Bell Pepper, Fluffy Perrier, Brown Corn, White Piglet, Green Potato, Big Cat, Green Bell Pepper, Blue Horse, Regular Parsnip, Spotted Pepsi, Purple Chocolate bar, Purple Mountain Dew, Regular Orange Juice, Brown Cinnabon, Turqoise Pellegrino, Big Milkshake, Blue Perrier, Purple Twinkie, Yellow Horse, Yellow Corn, Red Coke, Brown Zombie, Red Orange Juice, Spotted Pellegrino, Turqoise Coke, Purple Piglet, Spotted Spider, White Doughnut, White Mountain Dew, Pink Doughnut, Blue Cat, Green Twinkie, Turqoise Spider, Brown Milk, Small Doughnut, Big Milk, Orange Coke, Fluffy Fanta, Red Pellegrino, Yellow Cinnabon, Yellow Cucumber, White Twinkie, Yellow Cat, Pink Bell Pepper, Red Daikon, Small Bell Pepper, Regular Dog, Big Turnip, Pink Chicken, Fluffy Milk, Fluffy Milkshake, Purple Apple Juice, White Creeper, Orange Pellegrino, Big Gummy bears, Regular Pepsi, Red Pigman, Blue Milk, Green Vichy, Yellow Milkshake, White Carrot, Yellow Banana, Small Mountain Dew, Fluffy Corn, Yellow Gummy bears, Regular Pepper, Spotted Sheep, Pink Apple Juice, Pink Vichy, Red Dog, Orange Wine, Orange Chocolate Milk, Turqoise Dog, Purple Vichy, Big Beer, Red Parsnip, Blue Gummy bears, Spotted Chocolate Milk, Brown Cucumber, Turqoise Pigman, Brown Perrier, White Skeleton, Turqoise Wine, Brown Milkshake, Green Creeper, Purple Carrot, Turqoise Pepsi, Regular Cookie, Red Wine, Purple Creeper, Brown Gummy bears, Purple Skeleton, Brown Beer, Big Cinnabon, Fluffy Cucumber, Fluffy Gummy bears, Fluffy Horse, Green Mountain Dew, Small Spite, Yellow Turnip, Regular Wine, Red Spider, Purple Doughnut, Yellow Fanta, Small Skeleton, Pink Spite, Fluffy Cinnabon, Purple Spite, Brown Horse, Spotted Daikon, Regular Spider, Blue Cucumber, Pink Chocolate bar, Purple Potato, Yellow Milk, Turqoise Pepper, Turqoise Cookie, Regular Sheep, Yellow Beer, Turqoise Sheep, Green Carrot, Spotted Coke, Green Chicken, Turqoise Orange Juice, Green Spite, Big Banana, Pink Piglet, Orange Daikon, Red Sheep, White Apple Juice, Red Cookie, Brown Fanta, Small Creeper, Yellow Zombie, Big Corn, Yellow Perrier, Big Perrier, White Vichy, Big Zombie, Brown Banana, Pink Mountain Dew, Regular Daikon, Spotted Cookie, Orange Pigman, Small Twinkie, Spotted Wine, Green Doughnut, Orange Cookie, Small Carrot, Blue Turnip, Green Piglet]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Fluffy Zombie, Fluffy Zombie->Pink Potato, osmo.tester.START_STATE->Green Skeleton, Green Skeleton->Small Chicken, osmo.tester.START_STATE->Pink Creeper, Pink Creeper->Pink Skeleton, Pink Skeleton->Small Apple Juice, osmo.tester.START_STATE->Regular Chocolate Milk, Regular Chocolate Milk->Big Horse, osmo.tester.START_STATE->Spotted Pepper, Spotted Pepper->Orange Parsnip, osmo.tester.START_STATE->Turqoise Daikon, Turqoise Daikon->Turqoise Chocolate Milk, osmo.tester.START_STATE->White Bell Pepper, White Bell Pepper->Green Chocolate bar, osmo.tester.START_STATE->Orange Spider, Orange Spider->Fluffy Cat, osmo.tester.START_STATE->Regular Pigman, Regular Pigman->Red Chocolate Milk, osmo.tester.START_STATE->Spotted Dog, Spotted Dog->Blue Zombie, osmo.tester.START_STATE->Fluffy Beer, Fluffy Beer->Spotted Parsnip, osmo.tester.START_STATE->Regular Coke, Regular Coke->Pink Carrot, osmo.tester.START_STATE->Spotted Pigman, Spotted Pigman->Orange Pepper, osmo.tester.START_STATE->White Chocolate bar, White Chocolate bar->Blue Milkshake, osmo.tester.START_STATE->Green Apple Juice, Green Apple Juice->Blue Banana, osmo.tester.START_STATE->Small Chocolate bar, Small Chocolate bar->Fluffy Banana, osmo.tester.START_STATE->Fluffy Turnip, Fluffy Turnip->White Spite, osmo.tester.START_STATE->Blue Cinnabon, Blue Cinnabon->Blue Fanta, osmo.tester.START_STATE->Brown Cat, Brown Cat->Purple Chicken, osmo.tester.START_STATE->Blue Corn, Blue Corn->Orange Pepsi, osmo.tester.START_STATE->Orange Dog, Orange Dog->White Potato, osmo.tester.START_STATE->Small Piglet, Small Piglet->White Chicken, osmo.tester.START_STATE->Turqoise Parsnip, Turqoise Parsnip->Red Pepsi, osmo.tester.START_STATE->Red Pepper, Red Pepper->Blue Beer, osmo.tester.START_STATE->Regular Pellegrino, Regular Pellegrino->Orange Orange Juice, osmo.tester.START_STATE->Big Fanta, Big Fanta->Brown Turnip, osmo.tester.START_STATE->Small Potato, Small Potato->Spotted Orange Juice, osmo.tester.START_STATE->Small Vichy, Small Vichy->Orange Sheep, osmo.tester.START_STATE->Pink Twinkie, Pink Twinkie->Big Cucumber, osmo.tester.START_STATE->Purple Bell Pepper, Purple Bell Pepper->Fluffy Perrier, osmo.tester.START_STATE->Brown Corn, Brown Corn->White Piglet, osmo.tester.START_STATE->Green Potato, Green Potato->Big Cat, osmo.tester.START_STATE->Green Bell Pepper, Green Bell Pepper->Blue Horse, osmo.tester.START_STATE->Regular Parsnip, Regular Parsnip->Spotted Pepsi, osmo.tester.START_STATE->Purple Chocolate bar, Purple Chocolate bar->Purple Mountain Dew, osmo.tester.START_STATE->Regular Orange Juice, Regular Orange Juice->Brown Cinnabon, osmo.tester.START_STATE->Turqoise Pellegrino, Turqoise Pellegrino->Big Milkshake, osmo.tester.START_STATE->Blue Perrier, Blue Perrier->Purple Twinkie, osmo.tester.START_STATE->Yellow Horse, Yellow Horse->Yellow Corn, osmo.tester.START_STATE->Red Coke, Red Coke->Brown Zombie, osmo.tester.START_STATE->Red Orange Juice, Red Orange Juice->Spotted Pellegrino, osmo.tester.START_STATE->Turqoise Coke, Turqoise Coke->Purple Piglet, osmo.tester.START_STATE->Spotted Spider, Spotted Spider->White Doughnut, osmo.tester.START_STATE->White Mountain Dew, White Mountain Dew->Pink Doughnut, osmo.tester.START_STATE->Blue Cat, Blue Cat->Green Twinkie, osmo.tester.START_STATE->Turqoise Spider, Turqoise Spider->Brown Milk, osmo.tester.START_STATE->Small Doughnut, Small Doughnut->Big Milk, osmo.tester.START_STATE->Orange Coke, Orange Coke->Fluffy Fanta, osmo.tester.START_STATE->Red Pellegrino, Red Pellegrino->Yellow Cinnabon, osmo.tester.START_STATE->Yellow Cucumber, Yellow Cucumber->White Twinkie, osmo.tester.START_STATE->Yellow Cat, Yellow Cat->Pink Bell Pepper, osmo.tester.START_STATE->Red Daikon, Red Daikon->Small Bell Pepper, osmo.tester.START_STATE->Regular Dog, Regular Dog->Big Turnip, osmo.tester.START_STATE->Pink Chicken, Pink Chicken->Fluffy Milk, osmo.tester.START_STATE->Fluffy Milkshake, Fluffy Milkshake->Purple Apple Juice, osmo.tester.START_STATE->White Creeper, White Creeper->Orange Pellegrino, osmo.tester.START_STATE->Big Gummy bears, Big Gummy bears->Regular Pepsi, osmo.tester.START_STATE->Red Pigman, Red Pigman->Blue Milk, osmo.tester.START_STATE->Green Vichy, Green Vichy->Yellow Milkshake, osmo.tester.START_STATE->White Carrot, White Carrot->Yellow Banana, osmo.tester.START_STATE->Small Mountain Dew, Small Mountain Dew->Fluffy Corn, osmo.tester.START_STATE->Yellow Gummy bears, Yellow Gummy bears->Regular Pepper, osmo.tester.START_STATE->Spotted Sheep, Spotted Sheep->Pink Apple Juice, osmo.tester.START_STATE->Pink Vichy, Pink Vichy->Red Dog, osmo.tester.START_STATE->Orange Wine, Orange Wine->Orange Chocolate Milk, osmo.tester.START_STATE->Turqoise Dog, Turqoise Dog->Purple Vichy, osmo.tester.START_STATE->Big Beer, Big Beer->Red Parsnip, osmo.tester.START_STATE->Blue Gummy bears, Blue Gummy bears->Spotted Chocolate Milk, osmo.tester.START_STATE->Brown Cucumber, Brown Cucumber->Turqoise Pigman, osmo.tester.START_STATE->Brown Perrier, Brown Perrier->White Skeleton, osmo.tester.START_STATE->Turqoise Wine, Turqoise Wine->Brown Milkshake, osmo.tester.START_STATE->Green Creeper, Green Creeper->Purple Carrot, osmo.tester.START_STATE->Turqoise Pepsi, Turqoise Pepsi->Regular Cookie, osmo.tester.START_STATE->Red Wine, Red Wine->Purple Creeper, osmo.tester.START_STATE->Brown Gummy bears, Brown Gummy bears->Purple Skeleton, osmo.tester.START_STATE->Brown Beer, Brown Beer->Big Cinnabon, osmo.tester.START_STATE->Fluffy Cucumber, Fluffy Cucumber->Fluffy Gummy bears, osmo.tester.START_STATE->Fluffy Horse, Fluffy Horse->Green Mountain Dew, osmo.tester.START_STATE->Small Spite, Small Spite->Yellow Turnip, osmo.tester.START_STATE->Regular Wine, Regular Wine->Red Spider, osmo.tester.START_STATE->Purple Doughnut, Purple Doughnut->Yellow Fanta, osmo.tester.START_STATE->Small Skeleton, Small Skeleton->Pink Spite, osmo.tester.START_STATE->Fluffy Cinnabon, Fluffy Cinnabon->Purple Spite, osmo.tester.START_STATE->Brown Horse, Brown Horse->Orange Parsnip, osmo.tester.START_STATE->Spotted Daikon, Spotted Daikon->Green Chocolate bar, osmo.tester.START_STATE->Regular Spider, Regular Spider->Red Chocolate Milk, osmo.tester.START_STATE->Blue Cucumber, Blue Cucumber->Red Pepper, osmo.tester.START_STATE->Pink Chocolate bar, Pink Chocolate bar->Blue Cinnabon, osmo.tester.START_STATE->White Piglet, White Piglet->Purple Potato, osmo.tester.START_STATE->Yellow Milk, Yellow Milk->White Piglet, osmo.tester.START_STATE->Turqoise Pepper, Turqoise Pepper->Blue Milkshake, osmo.tester.START_STATE->White Chicken, White Chicken->Turqoise Cookie, osmo.tester.START_STATE->Regular Sheep, Regular Sheep->Regular Sheep, osmo.tester.START_STATE->Yellow Beer, Yellow Beer->Purple Piglet, osmo.tester.START_STATE->Turqoise Sheep, Turqoise Sheep->Spotted Pepsi, osmo.tester.START_STATE->Green Carrot, Green Carrot->Spotted Pigman, osmo.tester.START_STATE->Spotted Coke, Spotted Coke->White Chocolate bar, osmo.tester.START_STATE->Green Chicken, Green Chicken->Green Twinkie, osmo.tester.START_STATE->Turqoise Orange Juice, Turqoise Orange Juice->Blue Cat, osmo.tester.START_STATE->Green Spite, Green Spite->Blue Beer, osmo.tester.START_STATE->White Potato, White Potato->Big Banana, osmo.tester.START_STATE->Pink Piglet, Pink Piglet->Red Orange Juice, osmo.tester.START_STATE->Orange Daikon, Orange Daikon->Purple Apple Juice, osmo.tester.START_STATE->Purple Twinkie, Purple Twinkie->Red Sheep, osmo.tester.START_STATE->Pink Carrot, Pink Carrot->White Apple Juice, osmo.tester.START_STATE->Spotted Pepsi, Spotted Pepsi->Red Cookie, osmo.tester.START_STATE->Spotted Parsnip, Spotted Parsnip->Brown Fanta, osmo.tester.START_STATE->Small Creeper, Small Creeper->Blue Milk, osmo.tester.START_STATE->Yellow Zombie, Yellow Zombie->Red Parsnip, osmo.tester.START_STATE->Big Corn, Big Corn->Blue Milkshake, osmo.tester.START_STATE->Big Turnip, Big Turnip->Yellow Perrier, osmo.tester.START_STATE->Big Perrier, Big Perrier->Red Pepsi, osmo.tester.START_STATE->White Doughnut, White Doughnut->White Vichy, osmo.tester.START_STATE->Big Zombie, Big Zombie->Purple Piglet, osmo.tester.START_STATE->Small Chicken, Small Chicken->Brown Banana, osmo.tester.START_STATE->Pink Mountain Dew, Pink Mountain Dew->Spotted Spider, osmo.tester.START_STATE->Regular Daikon, Regular Daikon->Fluffy Gummy bears, osmo.tester.START_STATE->Spotted Cookie, osmo.tester.START_STATE->Orange Pigman, osmo.tester.START_STATE->Small Twinkie, osmo.tester.START_STATE->Spotted Wine, osmo.tester.START_STATE->Green Doughnut, osmo.tester.START_STATE->Orange Cookie, osmo.tester.START_STATE->Small Carrot, osmo.tester.START_STATE->Blue Turnip, osmo.tester.START_STATE->Green Piglet, osmo.tester.START_STATE->Orange Pepper, Orange Pepper->Orange Spider, osmo.tester.START_STATE->Orange Parsnip, Orange Parsnip->Purple Doughnut, osmo.tester.START_STATE->Red Chocolate Milk, Red Chocolate Milk->Pink Creeper, osmo.tester.START_STATE->Red Dog, Red Dog->Blue Cinnabon, osmo.tester.START_STATE->Blue Fanta, Blue Fanta->Pink Twinkie, osmo.tester.START_STATE->Fluffy Banana, Fluffy Banana->Turqoise Wine, osmo.tester.START_STATE->Big Cat, Big Cat->Turqoise Pigman, osmo.tester.START_STATE->Blue Beer, Blue Beer->Blue Beer, osmo.tester.START_STATE->Green Mountain Dew, Green Mountain Dew->Green Skeleton, osmo.tester.START_STATE->Yellow Corn, Yellow Corn->Regular Pellegrino, osmo.tester.START_STATE->Brown Milkshake, Brown Milkshake->Spotted Parsnip, osmo.tester.START_STATE->Spotted Pellegrino, Spotted Pellegrino->Yellow Turnip, osmo.tester.START_STATE->Turqoise Pigman, Turqoise Pigman->Turqoise Pigman, osmo.tester.START_STATE->Turqoise Chocolate Milk, Turqoise Chocolate Milk->Small Piglet, osmo.tester.START_STATE->Yellow Banana, Yellow Banana->Regular Coke, osmo.tester.START_STATE->Big Milk, Big Milk->Green Mountain Dew, osmo.tester.START_STATE->Regular Pepper, Regular Pepper->Purple Chicken, osmo.tester.START_STATE->Small Apple Juice, Small Apple Juice->Green Apple Juice, osmo.tester.START_STATE->Orange Pepsi, Orange Pepsi->Turqoise Pepper, osmo.tester.START_STATE->Yellow Fanta, Yellow Fanta->Red Pellegrino, osmo.tester.START_STATE->Brown Turnip, Brown Turnip->Regular Pellegrino, osmo.tester.START_STATE->Purple Apple Juice, Purple Apple Juice->Green Chocolate bar, osmo.tester.START_STATE->Blue Milk, Blue Milk->Pink Skeleton, osmo.tester.START_STATE->Fluffy Milk, Fluffy Milk->Purple Piglet, osmo.tester.START_STATE->Yellow Milkshake, Yellow Milkshake->Purple Spite, osmo.tester.START_STATE->Brown Milk, Brown Milk->Big Banana, osmo.tester.START_STATE->Blue Banana, Blue Banana->Spotted Coke, osmo.tester.START_STATE->Purple Skeleton, Purple Skeleton->Red Chocolate Milk, osmo.tester.START_STATE->Fluffy Gummy bears, Fluffy Gummy bears->Pink Creeper, osmo.tester.START_STATE->Regular Pepsi, Regular Pepsi->Brown Perrier, osmo.tester.START_STATE->Yellow Cinnabon, Yellow Cinnabon->White Chicken, osmo.tester.START_STATE->Big Milkshake, Big Milkshake->Yellow Turnip, osmo.tester.START_STATE->Big Cucumber, Big Cucumber->Pink Chocolate bar, osmo.tester.START_STATE->Regular Cookie, Regular Cookie->White Bell Pepper, osmo.tester.START_STATE->Fluffy Perrier, Fluffy Perrier->Turqoise Parsnip, osmo.tester.START_STATE->Red Parsnip, Red Parsnip->Red Parsnip, osmo.tester.START_STATE->Big Horse, Big Horse->Red Pepper, osmo.tester.START_STATE->Pink Apple Juice, Pink Apple Juice->Green Skeleton, osmo.tester.START_STATE->Green Chocolate bar, Green Chocolate bar->Fluffy Milk, osmo.tester.START_STATE->Blue Milkshake, Blue Milkshake->Red Pepsi, osmo.tester.START_STATE->Purple Vichy, Purple Vichy->Purple Creeper, osmo.tester.START_STATE->Fluffy Corn, Fluffy Corn->Small Doughnut, osmo.tester.START_STATE->Brown Fanta, Brown Fanta->Brown Zombie, osmo.tester.START_STATE->Blue Horse, Blue Horse->Spotted Chocolate Milk, osmo.tester.START_STATE->Red Cookie, Red Cookie->Blue Horse, osmo.tester.START_STATE->Red Pepsi, Red Pepsi->Green Spite, osmo.tester.START_STATE->Purple Mountain Dew, Purple Mountain Dew->Blue Perrier, osmo.tester.START_STATE->Orange Pellegrino, Orange Pellegrino->Turqoise Sheep, osmo.tester.START_STATE->Brown Zombie, Brown Zombie->Small Piglet, osmo.tester.START_STATE->Spotted Chocolate Milk, Spotted Chocolate Milk->Orange Chocolate Milk, osmo.tester.START_STATE->Pink Spite, Pink Spite->Brown Cat, osmo.tester.START_STATE->Brown Cinnabon, Brown Cinnabon->Yellow Cinnabon, osmo.tester.START_STATE->Big Banana, Big Banana->White Bell Pepper, osmo.tester.START_STATE->White Apple Juice, White Apple Juice->Big Gummy bears, osmo.tester.START_STATE->Big Cinnabon, Big Cinnabon->Fluffy Zombie, osmo.tester.START_STATE->Pink Bell Pepper, Pink Bell Pepper->Blue Milk, osmo.tester.START_STATE->Orange Orange Juice, Orange Orange Juice->Blue Cucumber, osmo.tester.START_STATE->White Skeleton, White Skeleton->Purple Spite, osmo.tester.START_STATE->Fluffy Cat, Fluffy Cat->Spotted Pepsi, osmo.tester.START_STATE->White Twinkie, White Twinkie->Purple Creeper, osmo.tester.START_STATE->Spotted Orange Juice, Spotted Orange Juice->Pink Piglet, osmo.tester.START_STATE->White Spite, White Spite->Purple Carrot, osmo.tester.START_STATE->Purple Creeper, Purple Creeper->Yellow Cinnabon, osmo.tester.START_STATE->White Vichy, White Vichy->Turqoise Pigman, osmo.tester.START_STATE->Small Bell Pepper, Small Bell Pepper->Purple Chicken, osmo.tester.START_STATE->Brown Banana, Brown Banana->Blue Corn, osmo.tester.START_STATE->Pink Potato, Pink Potato->Small Mountain Dew, osmo.tester.START_STATE->Orange Sheep, osmo.tester.START_STATE->Turqoise Cookie, Fluffy Beer->Regular Dog, osmo.tester.START_STATE->Blue Zombie, osmo.tester.START_STATE->Green Twinkie, osmo.tester.START_STATE->Orange Chocolate Milk, Brown Cat->Turqoise Daikon, osmo.tester.START_STATE->Purple Spite, Small Chocolate bar->Brown Milkshake, osmo.tester.START_STATE->Yellow Perrier, osmo.tester.START_STATE->Red Sheep, Regular Pigman->Turqoise Sheep, Big Fanta->Small Doughnut, Blue Corn->Regular Pigman, osmo.tester.START_STATE->Purple Carrot, Turqoise Dog->White Chicken, Big Fanta->White Creeper, Blue Cinnabon->Red Pepsi, Regular Chocolate Milk->Spotted Orange Juice, Spotted Parsnip->Spotted Pigman, Blue Perrier->Turqoise Chocolate Milk, osmo.tester.START_STATE->Purple Potato, Small Piglet->Pink Twinkie, osmo.tester.START_STATE->Purple Piglet, osmo.tester.START_STATE->Purple Chicken, osmo.tester.START_STATE->Red Spider, Spotted Dog->Orange Cookie, White Chicken->Big Milk, Small Vichy->Small Chocolate bar, Yellow Gummy bears->Spotted Pepsi, Spotted Parsnip->Pink Spite, osmo.tester.START_STATE->Pink Skeleton, Purple Chocolate bar->Small Chicken, osmo.tester.START_STATE->Yellow Turnip, osmo.tester.START_STATE->Pink Doughnut, osmo.tester.START_STATE->Fluffy Fanta, Regular Spider->Fluffy Cat, Pink Twinkie->Brown Fanta, Orange Parsnip->Red Coke, White Doughnut->Blue Corn, White Mountain Dew->Pink Carrot, Regular Chocolate Milk->Small Skeleton, Brown Beer->Brown Beer, Green Potato->Fluffy Horse, Spotted Parsnip->Orange Coke, Brown Horse->Spotted Pellegrino, Green Potato->Spotted Pepsi, Spotted Parsnip->Red Pigman, Small Vichy->Yellow Milkshake, Turqoise Spider->Regular Orange Juice, Regular Pigman->Big Corn, Spotted Dog->Red Orange Juice, Blue Corn->Green Chicken, Regular Wine->Pink Potato, White Carrot->Blue Corn, Green Potato->Purple Potato, Big Fanta->Pink Chocolate bar, Purple Twinkie->Orange Sheep, Small Vichy->Turqoise Cookie, Green Vichy->Big Cucumber, Turqoise Wine->Fluffy Zombie, Blue Cinnabon->Spotted Dog, White Mountain Dew->White Mountain Dew, Fluffy Milkshake->Blue Cinnabon, Green Apple Juice->Small Twinkie, Blue Fanta->Yellow Cucumber, Yellow Corn->Spotted Parsnip, Pink Twinkie->Big Horse, Pink Carrot->Brown Horse, White Carrot->Small Potato, Blue Fanta->Orange Pepper, Green Bell Pepper->Green Skeleton, Yellow Cat->Brown Milkshake, Turqoise Pepsi->Turqoise Pepsi, Red Daikon->Green Potato, Fluffy Beer->Spotted Chocolate Milk, Small Chocolate bar->Big Cinnabon, Orange Parsnip->Regular Dog, Turqoise Coke->Orange Sheep, Purple Twinkie->Turqoise Pepper, White Mountain Dew->Regular Pepsi, Fluffy Beer->Small Piglet, Brown Gummy bears->Small Chicken, Green Skeleton->Orange Parsnip, Turqoise Pellegrino->Blue Corn, Brown Gummy bears->Blue Horse, White Chicken->White Piglet, Red Pigman->Green Apple Juice, Turqoise Coke->Purple Chocolate bar, Green Vichy->Green Bell Pepper, Red Pepper->Pink Doughnut, Turqoise Sheep->Big Cucumber, White Piglet->Pink Chicken, Brown Milkshake->Orange Pepper, Orange Spider->Blue Cat, Yellow Corn->Yellow Corn, Turqoise Pepper->Regular Chocolate Milk, Regular Pigman->Yellow Horse, Big Milk->Fluffy Horse, Pink Twinkie->White Bell Pepper, Turqoise Daikon->Orange Coke, Yellow Cat->Small Carrot, Spotted Parsnip->Brown Cinnabon, Pink Creeper->Purple Apple Juice, Big Turnip->Yellow Fanta, Small Chocolate bar->Small Chocolate bar, Pink Twinkie->Small Potato, Orange Daikon->Purple Bell Pepper, Yellow Cat->Pink Skeleton, Purple Apple Juice->Orange Daikon, Turqoise Pepsi->Fluffy Fanta, Red Coke->Small Piglet, Yellow Cinnabon->Regular Chocolate Milk, Green Vichy->Big Perrier, Blue Cinnabon->Turqoise Wine, Red Pigman->Green Chocolate bar, Brown Milk->White Twinkie, Spotted Sheep->Purple Creeper, Green Vichy->Red Spider, Purple Bell Pepper->Spotted Pigman, Turqoise Pigman->Green Skeleton, Spotted Coke->Pink Potato, Fluffy Milk->Red Pepsi, Green Chicken->Regular Pepper, Regular Pepper->Turqoise Sheep, Yellow Beer->Orange Dog, Regular Spider->Yellow Corn, Blue Corn->Big Fanta, Yellow Milkshake->Pink Doughnut, Purple Doughnut->Pink Chicken, Blue Cinnabon->Blue Turnip, Blue Fanta->Orange Wine, Turqoise Daikon->Small Piglet, White Potato->Big Milk, Fluffy Gummy bears->Orange Wine, Big Cucumber->Blue Horse, Regular Cookie->Fluffy Perrier, Green Vichy->Blue Corn, Turqoise Chocolate Milk->Regular Spider, Big Gummy bears->Pink Skeleton, Red Pigman->Purple Vichy, Turqoise Pigman->Regular Wine, Purple Vichy->Small Mountain Dew, Green Potato->White Bell Pepper, Regular Orange Juice->Brown Zombie, Yellow Banana->Spotted Dog, Brown Gummy bears->Regular Cookie, Small Mountain Dew->Green Mountain Dew, Green Chocolate bar->Red Spider, Yellow Milk->Blue Milkshake, Big Milk->Turqoise Pellegrino, Brown Cat->Spotted Parsnip, Blue Cat->Big Perrier, Blue Perrier->Small Apple Juice, Regular Parsnip->Small Chocolate bar, Small Vichy->Orange Chocolate Milk, Yellow Cat->Green Doughnut, Turqoise Chocolate Milk->Yellow Corn, Blue Perrier->Big Corn, Big Beer->Blue Gummy bears, Yellow Zombie->Turqoise Coke, Pink Chicken->Big Cinnabon, Regular Orange Juice->Yellow Milkshake, Big Corn->Red Spider, Brown Gummy bears->Brown Turnip, Small Doughnut->Blue Horse, Purple Doughnut->Purple Doughnut, Fluffy Zombie->Small Twinkie, Yellow Zombie->Yellow Corn, Red Pepper->Orange Dog, Brown Milkshake->Pink Chocolate bar, Turqoise Pigman->Brown Cinnabon, Red Pepsi->Yellow Corn, Red Coke->Brown Turnip, Green Potato->Purple Twinkie, Big Perrier->Fluffy Cat, Blue Beer->Regular Chocolate Milk, Purple Mountain Dew->White Apple Juice, Small Doughnut->Regular Wine, Orange Daikon->Small Apple Juice, Turqoise Parsnip->Turqoise Coke, Blue Fanta->Red Coke, Small Apple Juice->Spotted Daikon, Big Turnip->Big Fanta, Purple Bell Pepper->Blue Zombie, White Chocolate bar->Spotted Coke, Regular Cookie->Brown Corn, Fluffy Gummy bears->Yellow Milk, Blue Perrier->Turqoise Wine, Blue Horse->Yellow Zombie, Blue Cucumber->Fluffy Corn, Orange Dog->Regular Pepper, Turqoise Chocolate Milk->Yellow Gummy bears, Small Piglet->Turqoise Wine, Green Creeper->Fluffy Gummy bears, Fluffy Cucumber->Spotted Pepsi, Brown Milk->Turqoise Coke, Regular Pellegrino->Purple Spite, Red Parsnip->Big Cat, Yellow Milkshake->Yellow Cinnabon, Blue Cucumber->Fluffy Banana, Regular Pigman->Brown Turnip, Regular Dog->Brown Beer, Big Gummy bears->Big Cucumber, Orange Dog->White Carrot, Big Perrier->Brown Zombie, Yellow Fanta->Spotted Pellegrino, Orange Orange Juice->Red Spider, Green Vichy->Pink Skeleton, Yellow Horse->Purple Doughnut, Red Pepsi->Purple Mountain Dew, Brown Cinnabon->Spotted Coke, Blue Cinnabon->Red Daikon, Small Skeleton->Yellow Cinnabon, Brown Beer->Yellow Cat, Fluffy Corn->Green Spite, Purple Apple Juice->Red Chocolate Milk, Big Milkshake->Big Horse, White Mountain Dew->Turqoise Spider, Blue Milk->Purple Vichy, Green Potato->Pink Potato, Regular Cookie->Spotted Coke, Big Corn->White Spite, Big Cinnabon->Red Pigman, Regular Chocolate Milk->Brown Milk, Blue Fanta->Turqoise Orange Juice, Blue Perrier->Fluffy Gummy bears, White Carrot->Regular Wine, Spotted Pepper->Orange Cookie, Blue Horse->Blue Milkshake, Pink Chocolate bar->Yellow Cinnabon, Yellow Cat->Small Mountain Dew, Purple Twinkie->Small Chicken, Fluffy Perrier->Purple Twinkie, Green Carrot->Spotted Sheep, Spotted Chocolate Milk->Blue Milk, White Creeper->Turqoise Pellegrino, Turqoise Dog->Fluffy Corn, Big Turnip->Yellow Zombie, Pink Chicken->Red Coke, Fluffy Banana->Spotted Sheep, Big Turnip->Red Daikon, Small Mountain Dew->Purple Creeper, Regular Spider->Pink Chicken, Green Vichy->Blue Perrier, Big Milk->White Piglet, Regular Sheep->Turqoise Dog]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 8266, coverage.getTotalSteps());
    assertEquals("Variable value total count", 74, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=3187, 20cents=2190, 10cents=2034, vend=855}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->20cents, 20cents->50cents, 50cents->50cents, 50cents->10cents, 10cents->20cents, 20cents->20cents, 20cents->10cents, 10cents->10cents, 10cents->50cents, 10cents->vend, vend->20cents, 50cents->vend, vend->10cents, .osmo.tester.start.step->10cents, vend->50cents, 20cents->vend, .osmo.tester.start.step->20cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 70, 120, 170, 180, 200, 220, 230, 240, 290, 300, 140, 160, 210, 260, 310, 65, 75, 95, 115, 10, 20, 40, 60, 110, 270, 125, 175, 225, 245, 255, 265, 285, 45, 100, 150, 250, 90, 280, 330, 130, 190, 30, 80, 340, 165, 185, 235, 295, 345, 320, 105, 155, 195, 205, 275, 325, 85, 135, 145, 25, 35, 55, 215, 315, 5, 15, 305, 0, 335], bottles=[10, 9, 8, 7]}", coverage.getVariableValues().toString());
  }

  private static class MyModelFactory implements ModelFactory {
    @Override
    public void createModelObjects(TestModels addHere) {
      addHere.add(new CalculatorModel());
    }
  }

  private static class MyIterationListener implements IterationListener {
    private int count = 0;
    private int finished = 0;
    private List<TestCase> finalTests = null;

    @Override
    public void iterationDone(List<TestCase> tests) {
      count++;
    }

    @Override
    public void generationDone(List<TestCase> tests) {
      finished++;
      finalTests = tests;
    }
  }
}
